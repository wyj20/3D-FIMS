<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>3Dè€—æç®¡ç† - åŒæ­¥å¼ºåŒ–ç‰ˆ</title>
    <style>
        :root {
            --main: #00acc1; --bg: #f5f5f5; --nav: #212121; --danger: #ff5252; --warn: #ff9800;
            --f-base: clamp(14px, 4vw, 18px);
            --f-card: clamp(16px, 4.5vw, 22px);
            --grid-cols: 2; 
        }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); margin: 0; padding-bottom: 80px; font-size: var(--f-base); -webkit-tap-highlight-color: transparent; }
        .tabs { display: flex; background: var(--nav); position: sticky; top: 0; z-index: 100; box-shadow: 0 2px 5px rgba(0,0,0,0.3); }
        .tab-btn { flex: 1; padding: 12px 2px; color: #777; border: none; background: none; font-size: 0.75rem; display: flex; flex-direction: column; align-items: center; }
        .tab-btn.active { color: white; border-bottom: 3px solid var(--main); font-weight: bold; }
        .tab-count { font-size: 0.7rem; margin-top: 2px; opacity: 0.8; }
        .search-container { background: white; padding: 10px 12px; position: sticky; top: 56px; z-index: 90; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        .search-input { width: 100%; padding: 10px 18px; border: 2px solid #eee; border-radius: 25px; font-size: 0.9rem; box-sizing: border-box; outline: none; }
        .container { padding: 12px; display: grid; grid-template-columns: repeat(var(--grid-cols), 1fr); gap: 12px; align-content: start; }
        .card { border-radius: 14px; padding: 1rem; position: relative; min-height: 140px; cursor: pointer; box-shadow: 0 5px 12px rgba(0,0,0,0.18); color: white; overflow: hidden; display: flex; flex-direction: column; }
        .card .brand { font-size: var(--f-card); font-weight: 900; line-height: 1.1; margin-bottom: 3px; }
        .card .type { font-size: 0.85rem; font-weight: 600; opacity: 0.9; }
        .card .notes { font-size: 0.7rem; opacity: 0.85; margin-top: 6px; font-style: italic; background: rgba(0,0,0,0.15); padding: 2px 6px; border-radius: 4px; display: inline-block; max-width: 95%; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
        .card-footer { display: flex; justify-content: space-between; align-items: flex-end; margin-top: auto; padding-top: 10px; }
        .action-area { display: flex; flex-direction: column; gap: 6px; flex: 1; }
        .action-btn { background: rgba(128,128,128,0.28); border: 1.5px solid rgba(128,128,128,0.45); color: inherit; border-radius: 6px; padding: 6px 10px; font-size: 0.75rem; font-weight: 900; width: fit-content; max-width: 100%; }
        .card .count { font-size: calc(2.8rem - (var(--grid-cols) * 0.5rem)); font-weight: 900; line-height: 1; margin-left: 5px; }
        .settings-group { grid-column: span var(--grid-cols); background: white; border-radius: 16px; padding: 20px; margin-bottom: 15px; box-shadow: 0 3px 6px rgba(0,0,0,0.06); }
        .settings-title { font-size: 1rem; font-weight: bold; margin-bottom: 15px; border-left: 4px solid var(--main); padding-left: 12px; }
        .select-picker { display: flex; gap: 8px; flex-wrap: wrap; }
        .select-option { flex: 1; min-width: 80px; padding: 10px; border: 2px solid #eee; border-radius: 10px; text-align: center; font-size: 0.85rem; cursor: pointer; }
        .select-option.active { border-color: var(--main); background: #e0f7f9; color: var(--main); font-weight: bold; }
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.75); z-index: 1000; align-items: center; justify-content: center; }
        .modal-content { background: white; width: 92%; max-width: 420px; border-radius: 22px; padding: 25px; color: #333; }
        .btn-row { display: flex; gap: 12px; margin-top: 15px; }
        .btn { flex: 1; padding: 15px; border-radius: 10px; border: none; cursor: pointer; font-size: 1.1rem; font-weight: bold; }
        .btn-main { background: var(--main); color: white; }
        .btn-cancel { background: #eee; color: #555; }
        .btn-danger { background: var(--danger); color: white; }
        .fab { position: fixed; bottom: 25px; right: 25px; width: 65px; height: 65px; background: var(--main); color: white; border-radius: 50%; border: none; font-size: 35px; box-shadow: 0 5px 15px rgba(0,0,0,0.4); z-index: 99; display: flex; align-items: center; justify-content: center; }
        .tag-container { display: flex; flex-wrap: wrap; gap: 8px; margin: 10px 0; }
        .tag { background: #f2f2f2; color: #444; padding: 6px 12px; border-radius: 20px; font-size: 0.75rem; border: 1px solid #ddd; display: flex; align-items: center; gap: 5px; }
        .sync-input { width: 100%; padding: 12px; margin-bottom: 10px; border: 1.5px solid #ddd; border-radius: 10px; font-size: 0.85rem; box-sizing: border-box; }
    </style>
</head>
<body>

<div class="tabs">
    <button class="tab-btn active" onclick="switchTab('sealed')">æ€»åº“å­˜<span id="cnt-sealed" class="tab-count">0</span></button>
    <button class="tab-btn" onclick="switchTab('inuse')">æ­£åœ¨ä½¿ç”¨<span id="cnt-inuse" class="tab-count">0</span></button>
    <button class="tab-btn" onclick="switchTab('opened')">å¼€å¯åº“<span id="cnt-opened" class="tab-count">0</span></button>
    <button class="tab-btn" onclick="switchTab('finished')">æ¶ˆè€—ç»Ÿè®¡<span id="cnt-finished" class="tab-count">0</span></button>
    <button class="tab-btn" onclick="switchTab('settings')">âš™ï¸ è®¾ç½®</button>
</div>

<div id="searchBox" class="search-container">
    <input type="text" id="searchInput" class="search-input" placeholder="ğŸ” æœå“ç‰Œã€å‹å·ã€å¤‡æ³¨..." oninput="render()">
</div>

<div id="content" class="container"></div>

<div id="warnModal" class="modal"><div class="modal-content" style="text-align:center;"><div id="warnIcon" style="font-size:50px;color:var(--warn);">âš ï¸</div><div id="warnTitle" style="font-weight:bold;font-size:1.2rem;margin-bottom:10px;">æé†’</div><p id="warnMsg" style="color:#666; font-size:0.95rem; margin-bottom:25px;"></p><div id="btnContainer" class="btn-row"><button class="btn" id="warnLeftBtn"></button><button class="btn" id="warnRightBtn"></button></div></div></div>

<div id="newModal" class="modal"><div class="modal-content"><div style="font-weight:bold;font-size:1.2rem;text-align:center;margin-bottom:15px;">å…¥åº“æ–°è€—æ</div>
    <div style="margin-bottom:12px;"><label style="font-size:0.75rem;color:#777;">å‚å®¶</label><input type="text" id="inBrand" style="width:100%;padding:12px;border:1px solid #ddd;border-radius:12px;box-sizing:border-box;"><div id="brandTags" class="tag-container"></div></div>
    <div style="margin-bottom:12px;"><label style="font-size:0.75rem;color:#777;">ç±»å‹</label><input type="text" id="inType" style="width:100%;padding:12px;border:1px solid #ddd;border-radius:12px;box-sizing:border-box;"><div id="typeTags" class="tag-container"></div></div>
    <div style="margin-bottom:12px;"><label style="font-size:0.75rem;color:#777;">å¤‡æ³¨</label><input type="text" id="inNotes" placeholder="å¤‡æ³¨ä¸åŒå³ä¸ºç‹¬ç«‹ä¸ªä½“" style="width:100%;padding:12px;border:1px solid #ddd;border-radius:12px;box-sizing:border-box;"></div>
    <div style="margin-bottom:12px;"><label style="font-size:0.75rem;color:#777;">é¢œè‰²</label><input type="color" id="inColor" value="#00acc1" style="width:100%;height:45px;border:none;"></div>
    <div style="margin-bottom:12px;"><label style="font-size:0.75rem;color:#777;">æ•°é‡ (æœ€å° 1)</label><input type="number" id="inCount" value="1" min="1" oninput="if(this.value<1)this.value='1'" style="width:100%;padding:12px;border:1px solid #ddd;border-radius:12px;box-sizing:border-box;"></div>
    <div class="btn-row"><button class="btn btn-cancel" onclick="closeModals()">å–æ¶ˆ</button><button class="btn btn-main" onclick="saveNew()">ä¿å­˜</button></div>
</div></div>

<div id="adjustModal" class="modal"><div class="modal-content"><div style="font-weight:bold;font-size:1.2rem;text-align:center;margin-bottom:15px;">æ•°é‡è°ƒèŠ‚ä¸ç®¡ç†</div>
    <div style="display:flex;align-items:center;justify-content:center;gap:20px;margin:20px 0;">
        <button style="width:60px;height:60px;font-size:2rem;border-radius:12px;border:1px solid #ccc;" onclick="stepAdjust(-1)">-</button>
        <input type="number" id="adjNum" style="width:100px;height:60px;text-align:center;font-size:1.8rem;font-weight:bold;border:2px solid #ddd;border-radius:12px;" oninput="if(this.value<1)this.value=1">
        <button style="width:60px;height:60px;font-size:2rem;border-radius:12px;border:1px solid #ccc;" onclick="stepAdjust(1)">+</button>
    </div>
    <div class="btn-row"><button class="btn btn-cancel" onclick="closeModals()">è¿”å›</button><button class="btn btn-main" onclick="confirmAdj()">ä¿å­˜ä¿®æ”¹</button></div>
    <button class="btn btn-danger" style="width:100%; margin-top:15px;" onclick="closeModals(); setTimeout(requestDelete, 100)">å½»åº•åˆ é™¤æ­¤è€—æ</button>
</div></div>

<button id="fab" class="fab" onclick="showModal('newModal')">+</button>

<script>
    let db = JSON.parse(localStorage.getItem('v41_filamentDB')) || {
        sealed: [], inuse: [], opened: [], finished: [], 
        config: { brands: ['æ‹“ç«¹', 'è‰ºæ¾', 'JAYO'], types: ['PLA', 'PETG', 'ABS', 'TPU'] },
        settings: { columns: 2, sortOrder: 'brand', ghToken: '', ghRepo: '' }, 
        lastBackup: 0, lastChange: 0
    };
    let currentTab = 'sealed', activeIdx = null, activeFrom = '';
    window.onbeforeunload = (e) => { if (db.lastChange > db.lastBackup) return "æœ‰ä¿®æ”¹æœªåŒæ­¥ï¼"; };
    function saveDB() { db.lastChange = Date.now(); localStorage.setItem('v41_filamentDB', JSON.stringify(db)); document.documentElement.style.setProperty('--grid-cols', db.settings.columns); }
    function getContrastColor(hex) { const r=parseInt(hex.slice(1,3),16), g=parseInt(hex.slice(3,5),16), b=parseInt(hex.slice(5,7),16); return (((r * 299) + (g * 587) + (b * 114)) / 1000 >= 128) ? '#000' : '#FFF'; }
    function render() {
        const container = document.getElementById('content');
        const term = document.getElementById('searchInput').value.toLowerCase();
        container.innerHTML = ''; updateCounts();
        document.documentElement.style.setProperty('--grid-cols', db.settings.columns);
        const isSet = currentTab === 'settings';
        document.getElementById('fab').style.display = isSet ? 'none' : 'flex';
        document.getElementById('searchBox').style.display = isSet ? 'none' : 'block';
        if (isSet) {
            container.innerHTML = `
                <div class="settings-group"><div class="settings-title">ğŸ¨ ç•Œé¢æ˜¾ç¤ºè®¾ç½®</div>
                <div class="select-picker">${[1,2,3].map(n => `<div class="select-option ${db.settings.columns==n?'active':''}" onclick="updateCols(${n})">${n}åˆ—</div>`).join('')}</div></div>
                <div class="settings-group"><div class="settings-title">ğŸ“Š è€—ææ’åºé€»è¾‘</div>
                <div class="select-picker">
                    <div class="select-option ${db.settings.sortOrder=='brand'?'active':''}" onclick="updateSort('brand')">æŒ‰å“ç‰Œ</div>
                    <div class="select-option ${db.settings.sortOrder=='type'?'active':''}" onclick="updateSort('type')">æŒ‰ç±»å‹</div>
                    <div class="select-option ${db.settings.sortOrder=='count'?'active':''}" onclick="updateSort('count')">æŒ‰æ•°é‡</div>
                </div></div>
                <div class="settings-group"><div class="settings-title">ğŸ™ GitHub äº‘åŒæ­¥ (å¼ºåŒ–ç‰ˆ)</div>
                <input type="password" id="ghToken" class="sync-input" value="${db.settings.ghToken}" placeholder="GitHub Token (ghp_...)">
                <input type="text" id="ghRepo" class="sync-input" value="${db.settings.ghRepo}" placeholder="ä»“åº“è·¯å¾„ (ä¾‹: WYJ20/3D)">
                <div style="display:flex; gap:10px;">
                    <button class="btn btn-main" style="font-size:0.8rem;" id="btn-up" onclick="githubSync('upload')">â†‘ ä¸Šä¼ åŒæ­¥</button>
                    <button class="btn btn-cancel" style="font-size:0.8rem; color:var(--main); border:1.5px solid var(--main);" id="btn-down" onclick="githubSync('download')">â†“ ä¸‹è½½åŒæ­¥</button>
                </div></div>
                <div class="settings-group"><div class="settings-title">âš™ï¸ ç³»ç»Ÿç»´æŠ¤</div>
                <button class="btn btn-cancel" style="width:100%; border:1.5px solid var(--danger); color:var(--danger);" onclick="requestReset()">æ¢å¤é»˜è®¤çŠ¶æ€</button></div>`;
            return;
        }
        let sorted = [...db[currentTab]].sort((a,b) => {
            const o = db.settings.sortOrder;
            if(o === 'type') return a.type.localeCompare(b.type,'zh') || a.brand.localeCompare(b.brand,'zh');
            if(o === 'count') return (b.count - a.count) || a.brand.localeCompare(b.brand,'zh');
            return a.brand.localeCompare(b.brand,'zh') || a.type.localeCompare(b.type,'zh') || (a.notes||"").localeCompare(b.notes||"","zh");
        });
        sorted.forEach(item => {
            if(item.count < 1) item.count = 1; 
            if(!item.brand.toLowerCase().includes(term) && !item.type.toLowerCase().includes(term) && !(item.notes||"").toLowerCase().includes(term)) return;
            const realIdx = db[currentTab].indexOf(item), txtC = getContrastColor(item.color);
            const card = document.createElement('div');
            card.className = 'card'; card.style.backgroundColor = item.color; card.style.color = txtC;
            if(currentTab !== 'finished') card.onclick = () => { activeIdx = realIdx; activeFrom = currentTab; document.getElementById('adjNum').value = item.count; showModal('adjustModal'); };
            let btns = ''; const btnS = `style="color:${txtC}; border-color:${txtC}80"`;
            if(currentTab === 'sealed') btns = `<button class="action-btn" ${btnS} onclick="event.stopPropagation(); checkUnseal(${realIdx})">æ‹†å°ä¸€å·</button>`;
            else if(currentTab === 'inuse') btns = `<button class="action-btn" ${btnS} onclick="event.stopPropagation(); move(${realIdx},'inuse','opened')">å­˜æ”¾</button><button class="action-btn" ${btnS} onclick="event.stopPropagation(); confirmFinish(${realIdx},'inuse')">å·²ç©º</button>`;
            else if(currentTab === 'opened') btns = `<button class="action-btn" ${btnS} onclick="event.stopPropagation(); move(${realIdx},'opened','inuse')">ä¸Šæœº</button><button class="action-btn" ${btnS} onclick="event.stopPropagation(); confirmFinish(${realIdx},'opened')">å·²ç©º</button>`;
            card.innerHTML = `<div class="brand">${item.brand}</div><div class="type">${item.type}</div>${item.notes?`<div class="notes"># ${item.notes}</div>`:''}
                              <div class="card-footer"><div class="action-area">${btns}</div><div class="count">${item.count}</div></div>`;
            container.appendChild(card);
        });
        renderTags();
    }

    async function githubSync(action) {
        const token = document.getElementById('ghToken').value, repo = document.getElementById('ghRepo').value;
        if (!token || !repo) { alert("è¯·è¡¥å…¨ Token å’Œè·¯å¾„ï¼"); return; }
        const upBtn = document.getElementById('btn-up'), downBtn = document.getElementById('btn-down');
        upBtn.innerText = "â³ å¤„ç†ä¸­..."; downBtn.disabled = true;

        db.settings.ghToken = token; db.settings.ghRepo = repo; saveDB();
        const url = `https://api.github.com/repos/${repo}/contents/data.json`, headers = { 'Authorization': `token ${token}`, 'Accept': 'application/vnd.github.v3+json' };
        
        try {
            if (action === 'upload') {
                let sha = ""; 
                const getRes = await fetch(url, { headers }); 
                if (getRes.ok) { const meta = await getRes.json(); sha = meta.sha; }
                const res = await fetch(url, { method: 'PUT', headers, body: JSON.stringify({ message: "Update filaments sync", content: btoa(unescape(encodeURIComponent(JSON.stringify(db)))), sha })});
                if (res.ok) { db.lastBackup = Date.now(); saveDB(); alert("âœ… GitHub äº‘ç«¯ä¸Šä¼ æˆåŠŸï¼"); }
                else { const err = await res.json(); alert("âŒ ä¸Šä¼ å¤±è´¥: " + (err.message || "æœªçŸ¥é”™è¯¯")); }
            } else {
                const res = await fetch(url, { headers });
                if (res.ok) { 
                    const data = await res.json(); 
                    db = JSON.parse(decodeURIComponent(escape(atob(data.content)))); 
                    saveDB(); render(); alert("âœ… äº‘ç«¯ä¸‹è½½æˆåŠŸï¼å·²åŒæ­¥ 121 å·æ•°æ®ã€‚"); 
                } else { alert("âŒ æ‰¾ä¸åˆ°äº‘ç«¯å¤‡ä»½ï¼Œè¯·å…ˆå°è¯•ä¸Šä¼ ã€‚"); }
            }
        } catch(e) { alert("âŒ ç½‘ç»œé”™è¯¯: è¯·æ£€æŸ¥ Token æ˜¯å¦æœ‰æ•ˆåŠä»“åº“è·¯å¾„æ˜¯å¦æ­£ç¡®ã€‚"); }
        upBtn.innerText = "â†‘ ä¸Šä¼ åŒæ­¥"; downBtn.disabled = false;
    }

    function requestDelete() { const item = db[activeFrom][activeIdx]; if (!item) return; showCustomWarn("å½»åº•åˆ é™¤", `ç¡®å®šåˆ é™¤è€—æã€${item.brand} ${item.type}ã€‘å—ï¼Ÿ`, "å–æ¶ˆ", "btn-cancel", closeModals, "ç¡®å®šåˆ é™¤", "btn-danger", () => { db[activeFrom].splice(activeIdx, 1); saveDB(); render(); closeModals(); }); }
    function requestReset() { showCustomWarn("é‡ç½®é…ç½®", "ç•Œé¢å°†æ¢å¤é»˜è®¤ï¼Œåº“å­˜ä¿ç•™ã€‚", "å–æ¶ˆ", "btn-cancel", closeModals, "é‡ç½®", "btn-danger", () => { db.settings = { columns: 2, sortOrder: 'brand', ghToken: db.settings.ghToken, ghRepo: db.settings.ghRepo }; db.config = { brands: ['æ‹“ç«¹', 'è‰ºæ¾', 'JAYO'], types: ['PLA', 'PETG', 'ABS', 'TPU'] }; saveDB(); render(); closeModals(); }); }
    function switchTab(t) { currentTab = t; document.getElementById('searchInput').value = ''; document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active')); event.currentTarget.classList.add('active'); render(); }
    function showCustomWarn(t, m, lT, lC, lF, rT, rC, rF) { document.getElementById('warnTitle').innerText = t; document.getElementById('warnMsg').innerText = m; const lB = document.getElementById('warnLeftBtn'), rB = document.getElementById('warnRightBtn'); lB.innerText = lT; lB.className = "btn " + lC; lB.onclick = lF; rB.innerText = rT; rB.className = "btn " + rC; rB.onclick = rF; document.getElementById('warnModal').style.display = 'flex'; }
    function updateSort(v) { db.settings.sortOrder = v; saveDB(); render(); }
    function updateCols(n) { db.settings.columns = n; saveDB(); render(); }
    function checkUnseal(idx) { let item = db.sealed[idx]; let dup = db.inuse.concat(db.opened).find(i => i.brand === item.brand && i.type === item.type && i.color === item.color); if (dup) showCustomWarn("é‡å¤å¼€å¯", "ç›¸åŒè€—æåœ¨æœºï¼ç¡®è®¤ï¼Ÿ", "æ”¾å¼ƒ", "btn-cancel", closeModals, "ç¡®è®¤", "btn-main", () => { doUnseal(idx); }); else doUnseal(idx); }
    function doUnseal(idx) { let item = db.sealed[idx]; item.count--; if(item.count<=0) db.sealed.splice(idx,1); let exist = db.inuse.find(i=>i.brand===item.brand && i.type===item.type && i.color===item.color && i.notes===item.notes); if(exist) exist.count++; else db.inuse.push({...item, count:1}); saveDB(); render(); closeModals(); }
    function confirmFinish(idx, f) { activeIdx = idx; activeFrom = f; showCustomWarn("ç»“ç®—æ–¹å¼", "è¯·é€‰æ‹©æ“ä½œå†…å®¹ï¼š", "å…¨éƒ¨æ¸…é™¤", "btn-danger", () => { doFinish('all'); }, "æ¶ˆè€—1å·", "btn-main", () => { doFinish(1); }); }
    function doFinish(m) { let item = db[activeFrom][activeIdx], n = (m===1)?1:item.count; let exist = db.finished.find(i => i.brand === item.brand && i.type === item.type && i.color === item.color && i.notes === item.notes); if(exist) exist.count += n; else db.finished.push({...item, count:n}); if(m===1) { item.count--; if(item.count<=0) db[activeFrom].splice(activeIdx,1); } else db[activeFrom].splice(activeIdx,1); saveDB(); render(); closeModals(); }
    function confirmAdj() { let n = parseInt(document.getElementById('adjNum').value); if (isNaN(n) || n < 1) n = 1; db[activeFrom][activeIdx].count = n; saveDB(); render(); closeModals(); }
    function saveNew() { const b=document.getElementById('inBrand').value.trim(), t=document.getElementById('inType').value.trim(), c=document.getElementById('inColor').value, nts=document.getElementById('inNotes').value.trim(); let n=parseInt(document.getElementById('inCount').value); n=Math.max(1, n||1); if(!b || !t) return; if(!db.config.brands.includes(b)) db.config.brands.push(b); if(!db.config.types.includes(t)) db.config.types.push(t); let exist = db.sealed.find(i=>i.brand===b && i.type===t && i.color===c && i.notes===nts); if(exist) exist.count += n; else db.sealed.push({brand:b, type:t, color:c, count:n, notes:nts}); saveDB(); render(); closeModals(); }
    function exportDB() { const a=document.createElement('a'); a.href=URL.createObjectURL(new Blob([JSON.stringify(db,null,2)], {type:"application/json"})); a.download=`3Då¤‡ä»½.json`; a.click(); db.lastBackup=Date.now(); saveDB(); }
    function importDB(e) { const f=e.target.files[0]; if(!f)return; const r=new FileReader(); r.onload=(ev)=>{ try { const d=JSON.parse(ev.target.result); if(!d.sealed)throw 0; db = d; saveDB(); render(); alert("æˆåŠŸï¼"); } catch(e){alert("é”™è¯¯ï¼");}}; r.readAsText(f); }
    function renderTags() { const build = (cat, list) => list.map(v => `<span class="tag" onclick="setIn('in${cat}','${v}')">${v}<span style="color:#ccc" onclick="event.stopPropagation(); delTag('${cat}','${v}')">Ã—</span></span>`).join('') + `<span class="tag" style="border-style:dashed;color:var(--main)" onclick="addTag('${cat}')">+</span>`; if(document.getElementById('brandTags')) document.getElementById('brandTags').innerHTML = build('Brand', db.config.brands); if(document.getElementById('typeTags')) document.getElementById('typeTags').innerHTML = build('Type', db.config.types); }
    function addTag(c) { let v = prompt("æ–°æ ‡ç­¾:"); if(v) { let l = c==='Brand'?db.config.brands:db.config.types; if(!l.includes(v))l.push(v); renderTags(); saveDB(); } }
    function delTag(c,v) { let l = c==='Brand'?db.config.brands:db.config.types; let i = l.indexOf(v); if(i>-1)l.splice(i,1); renderTags(); saveDB(); }
    function setIn(id, v) { document.getElementById(id).value = v; }
    function move(idx, f, t) { let item = db[f].splice(idx, 1)[0], exist = db[t].find(i=>i.brand===item.brand && i.type===item.type && i.color===item.color && i.notes===item.notes); if(exist) exist.count += item.count; else db[t].push(item); saveDB(); render(); }
    function stepAdjust(v) { let el = document.getElementById('adjNum'); el.value = Math.max(1, (parseInt(el.value)||1)+v); }
    function updateCounts() { ['sealed','inuse','opened','finished'].forEach(k => { document.getElementById('cnt-'+k).innerText = db[k].reduce((s,i)=>s+(parseInt(i.count)||0),0); }); }
    function showModal(id) { document.getElementById(id).style.display = 'flex'; }
    function closeModals() { document.querySelectorAll('.modal').forEach(m => m.style.display='none'); }
    render();
</script>
</body>
</html>
